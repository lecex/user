package handler

import (
	db "github.com/lecex/user/providers/database"

	authPB "github.com/lecex/user/proto/auth"
	casbinPB "github.com/lecex/user/proto/casbin"
	frontPermitPB "github.com/lecex/user/proto/frontPermit"
	permissionPB "github.com/lecex/user/proto/permission"
	rolePB "github.com/lecex/user/proto/role"
	userPB "github.com/lecex/user/proto/user"

	"github.com/lecex/user/service"
	"github.com/lecex/user/service/repository"
)

// Handler 注册方法
type Handler struct {}

// Register 注册
func (srv *Hander) Register(server)  {
	userPB.RegisterUsersHandler(server, srv.User())	// 用户服务实现
	authPB.RegisterAuthHandler(server, srv.Auth())	// token 服务实现
	frontPermitPB.RegisterFrontPermitsHandler(server, srv.FrontPermit())	// 前端权限服务实现
	permissionPB.RegisterPermissionsHandler(server, srv.Permission())	// 权限服务实现
	rolePB.RegisterRolesHandler(server, srv.Role())	// 角色服务实现
	casbinPB.RegisterCasbinHandler(server, srv.Casbin()) // 权限管理服务实现
}

// User 实例化
func (srv *Hander) User() *User {
	repo := &repository.UserRepository{db.DB}
	return  &User{repo}
}

// Auth 实例化
func (srv *Hander) Auth() *Auth {
	token := &service.TokenService{}
	repo := &repository.UserRepository{db.DB}
	return  &Auth{token, repo}
}

// FrontPermit 实例化
func (srv *Hander) FrontPermit() *FrontPermit {
	repo := &repository.FrontPermitRepository{db.DB}
	return  &FrontPermit{repo}
}

// Permission 实例化
func (srv *Hander) Permission() *Permission {
	repo := &repository.PermissionRepository{db.DB}
	return  &Permission{repo}
}

// Role 实例化
func (srv *Hander) Role() *Role {
	repo := &repository.RoleRepository{db.DB}
	return  &Role{repo}
}




